<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Flip</title>
  <style>
    body{
      font-family: 'Comic Neue', sans-serif;
      background:#FFB6C1;
      margin:0; padding:0;
      display:flex; flex-direction:column;
      align-items:center; min-height:100vh;
    }
    h1{ margin:24px 0 8px; font-size:2.4rem; }
    .sub{ margin:0 0 12px; }
    .feedback{ min-height:1.6rem; margin:8px 0 12px; font-size:1.2rem; }
    .hidden{ display:none; }
    .controls{ margin:10px 0; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }

    /* Buttons (default) */
    button{
      background:#FFD700; color:#000;
      padding:10px 18px; border:none; border-radius:12px;
      font-size:1rem; cursor:pointer;
    }
    .mode-btn{ background:#fff; border:2px solid #FFD700; }
    .mode-btn.active{ background:#FFD700; }

    /* Ensure anchors styled like buttons (Navigation Standard) */
    a.btnlike{
      background:#FFD700; color:#000;
      padding:10px 18px; border:none; border-radius:12px;
      font-size:1rem; cursor:pointer; text-decoration:none; display:inline-block;
    }
    /* Accessible focus ring for both buttons and anchors */
    button:focus, a.btnlike:focus{ outline:4px solid #000; outline-offset:2px; }

    /* Specific launch button colours to mirror emotions.html */
    #startBtn{ background:#90EE90; }
    #howBtn{  background:#FFD700; }
    #homeBtn{ background:#87CEFA; }

    /* Between/End screen return anchors colour */
    #homeBtn2{ background:#87CEFA; }
    #homeBtnEnd{ background:#87CEFA; }

    /* Boards */
    .game-board{ display:grid; gap:12px; margin:12px auto 24px; }
    .easy-board { grid-template-columns: repeat(4, 100px); }
    .hard-board { grid-template-columns: repeat(6, 90px); }
    .card{
      width:100px; height:100px;
      position:relative; perspective:1000px;
      overflow:hidden;
    }
    .hard-board .card{ width:90px; height:90px; }
    .card-inner{
      position:absolute; inset:0;
      transform-style:preserve-3d;
      transition: transform 0.45s ease;
    }
    .card.flipped .card-inner{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius:12px;
      object-fit: cover;
      width:100%; height:100%;
    }
    .front{ transform: rotateY(180deg); }
    .shake{ animation:shake 0.35s; }
    @keyframes shake{
      0%{ transform:translateX(0); }
      25%{ transform:translateX(-5px); }
      50%{ transform:translateX(5px); }
      75%{ transform:translateX(-5px); }
      100%{ transform:translateX(0); }
    }
    .matched{ opacity:0; pointer-events:none; transition: opacity 0.25s ease; }
    #end{ text-align:center; margin-top:20px; }

    /* ---------- Launch screen (mirror emotions.html) ---------- */
    /* Full-bleed, fixed viewport container */
    #instructions{
      position: fixed; inset: 0;
      width: 100vw; height: 100vh;
      overflow: hidden;
      display: flex; align-items: center; justify-content: center;
      padding: 16px;
      box-sizing: border-box;
      z-index: 10; /* above body content until hidden */
    }
    /* Full-screen background image layer */
    #instructions::before{
      content: "";
      position: absolute; inset: 0;
      background: url('assets/memory/images/ui/bg-launch.png') center/cover no-repeat;
      z-index: 0;
    }
    #instructions > *{ position: relative; z-index: 1; }

    /* Intro card */
    .intro-card{
      width: min(720px, 92vw);
      background: rgba(255,253,253,0.85);
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.20);
      padding: 20px 18px;
      text-align: center;
      margin: 0 auto;
    }

    /* Unit pill (match reference look & color token) */
    .unit-overline{
      margin-top: 4px;
      margin-bottom: 8px;
      padding: 6px 12px;
      display: inline-block;
      border-radius: 999px;
      background: #f5c242;
      color: #111;
      font-size: 0.95rem;
      font-weight: 800;
      letter-spacing: 0.2px;
      border: 1px solid rgba(0,0,0,0.08);
      text-transform: none; /* preserve text as provided */
    }

    /* Legacy launch inner (kept for how-to panel styling parity) */
    #howTo {
      max-width: 720px;
      margin: 0 auto;
      background: #fff8cc;
      border: 2px dashed #FFD700;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 1rem;
    }
  
    /* Force-hide launch overlay when hidden */
    #instructions.hidden { display: none !important; }

  </style>
</head>
<body>

  <!-- Launch screen -->
  <div id="instructions">
    <div class="intro-card">
      <div class="unit-overline" role="text">Unit 4: How Memory Works</div>
      <h1 style="margin-top:8px;">Memory Flip</h1>
      <p class="sub">Flip the cards and find all the pairs!</p>

      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="howBtn" class="mode-btn">How to Play</button>
        <!-- Navigation Standard: semantic anchor for park -->
        <a id="homeBtn" class="btnlike" href="lesson-screen-htmls/lesson-04.01.html">Return to the Park</a>
      </div>

      <div id="howTo" class="hidden">
        <p><strong>How to Play:</strong></p>
        <ul>
          <li>Tap a card to flip it. Then flip another to find a match.</li>
          <li>Find all pairs in <em>Round 1</em>, then continue to <em>Round 2</em>!</li>
          <li>Use your memory power—look, think, and match!</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Game screen -->
  <div id="game" class="hidden">
    <div class="feedback" id="feedback"></div>
    <div id="gameBoard" class="game-board easy-board"></div>
  </div>

  <!-- Between-round screen -->
  <div id="between" class="hidden">
    <h2>Great job! Get ready for Round 2!</h2>
    <div class="controls">
      <button id="nextRoundBtn">Start Round 2</button>
      <!-- Semantic anchor for park navigation -->
      <a id="homeBtn2" class="btnlike" href="lesson-screen-htmls/lesson-04.01.html">Return to the Park</a>
    </div>
  </div>

  <!-- End screen -->
  <div id="end" class="hidden">
    <h2>You found all the pairs! Your memory is amazing.</h2>
    <p>Your brain is like a treasure chest for memories!</p>
    <div class="controls">
      <button id="playAgainBtn">Play Again</button>
      <!-- Semantic anchor for park navigation -->
      <a id="homeBtnEnd" class="btnlike" href="lesson-screen-htmls/lesson-04.01.html">Return to the Park</a>
    </div>
  </div>

  <audio id="bgm" src="assets/memory/audio/memory-bgm.mp3" loop></audio>

  <script>
    // --- Base names (no extension) ---
    const EASY_BASES = [
      'assets/memory/easy/emotion-1',
      'assets/memory/easy/emotion-2',
      'assets/memory/easy/emotion-3',
      'assets/memory/easy/emotion-4',
      'assets/memory/easy/animal-1',
      'assets/memory/easy/animal-2',
      'assets/memory/easy/animal-3',
      'assets/memory/easy/animal-4',
    ];
    const EASY_BACK = 'assets/memory/easy/card-back';

    const HARD_BASES = [
      'assets/memory/hard/object-1',
      'assets/memory/hard/object-2',
      'assets/memory/hard/object-3',
      'assets/memory/hard/object-4',
      'assets/memory/hard/pattern-1',
      'assets/memory/hard/pattern-2',
      'assets/memory/hard/pattern-3',
      'assets/memory/hard/pattern-4',
      'assets/memory/hard/shape-1',
      'assets/memory/hard/shape-2',
      'assets/memory/hard/shape-3',
      'assets/memory/hard/shape-4',
    ];
    const HARD_BACK = 'assets/memory/hard/card-back';

    function smartImg(srcBase, cls){
      const img = document.createElement('img');
      img.className = 'face ' + cls;
      img.src = srcBase + '.png';
      img.alt = cls;
      img.onerror = () => { img.onerror = null; img.src = srcBase; };
      return img;
    }

    // Elements
    const instructionsEl = document.getElementById('instructions');
    const gameEl = document.getElementById('game');
    const endEl = document.getElementById('end');
    const betweenEl = document.getElementById('between');
    const boardEl = document.getElementById('gameBoard');
    const feedbackEl = document.getElementById('feedback');
    const bgm = document.getElementById('bgm');

    // Controls
    const startBtn = document.getElementById('startBtn');
    const howBtn = document.getElementById('howBtn');
    const howToEl = document.getElementById('howTo');
    const homeBtn = document.getElementById('homeBtn');
    const homeBtn2 = document.getElementById('homeBtn2');
    const homeBtnEnd = document.getElementById('homeBtnEnd');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const nextRoundBtn = document.getElementById('nextRoundBtn');

    // Game state
    let round = 1; // 1 -> easy; 2 -> hard
    let firstCard = null;
    let secondCard = null;
    let lockBoard = false;
    let totalPairs = 0;
    let matchedPairs = 0;

    // Wire up controls (NOTE: Navigation uses anchors; no JS for park links)
    startBtn.addEventListener('click', () => { round = 1; startGame(); });
    howBtn.addEventListener('click', () => { howToEl.classList.toggle('hidden'); });
    // Removed JS listeners for homeBtn/homeBtn2/homeBtnEnd to comply with Navigation Standard
    if (playAgainBtn) playAgainBtn.addEventListener('click', restartGame);
    if (nextRoundBtn) nextRoundBtn.addEventListener('click', () => { betweenEl.classList.add('hidden'); gameEl.classList.remove('hidden'); round = 2; initBoard(); });

    function startGame(){
      instructionsEl.classList.add('hidden');
      instructionsEl.style.display = 'none';
      endEl.classList.add('hidden');
      betweenEl.classList.add('hidden');
      gameEl.classList.remove('hidden');

      bgm.currentTime = 0;
      bgm.play().catch(()=>{});

      initBoard();
    }

    function initBoard(){
      boardEl.innerHTML = '';
      feedbackEl.textContent = '';
      firstCard = secondCard = null;
      lockBoard = false;
      matchedPairs = 0;

      const isHard = (round === 2);
      const BASES = isHard ? HARD_BASES : EASY_BASES;
      const BACK = isHard ? HARD_BACK : EASY_BACK;

      // adjust board sizing
      boardEl.className = 'game-board ' + (isHard ? 'hard-board' : 'easy-board');

      // Build deck
      const deck = [...BASES, ...BASES]
        .map((b) => ({ base: b, id: b }))
        .sort(() => Math.random() - 0.5);

      totalPairs = BASES.length;

      deck.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.key = item.id;

        const inner = document.createElement('div');
        inner.className = 'card-inner';

        const front = smartImg(item.base, 'front');
        const back = smartImg(BACK, 'back');

        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);

        card.addEventListener('click', onCardClick);
        boardEl.appendChild(card);
      });
    }

    function onCardClick(e){
      const card = e.currentTarget;
      if (lockBoard || card === firstCard || card.classList.contains('matched')) return;
      card.classList.add('flipped');
      if (!firstCard){ firstCard = card; return; }
      secondCard = card;
      lockBoard = true;
      checkForMatch();
    }

    function checkForMatch(){
      const isMatch = firstCard.dataset.key === secondCard.dataset.key;

      if (isMatch){
        feedbackEl.textContent = "Good job! That's a match.";
        setTimeout(() => {
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');
          resetPick();
          matchedPairs++;
          if (matchedPairs === totalPairs) handleRoundComplete();
        }, 200);
      } else {
        feedbackEl.textContent = 'Not quite – try again.';
        firstCard.classList.add('shake');
        secondCard.classList.add('shake');
        setTimeout(() => {
          firstCard.classList.remove('flipped', 'shake');
          secondCard.classList.remove('flipped', 'shake');
          resetPick();
        }, 650);
      }
    }

    function resetPick(){ [firstCard, secondCard, lockBoard] = [null, null, false]; }

    function handleRoundComplete(){
      if (round === 1){
        // Transition to Round 2 (like memory-2 multi-round flow)
        gameEl.classList.add('hidden');
        betweenEl.classList.remove('hidden');
      } else {
        // Finished Round 2 -> End screen
        endGame();
      }
    }

    function endGame(){
      gameEl.classList.add('hidden');
      betweenEl.classList.add('hidden');
      endEl.classList.remove('hidden');
    }

    function restartGame(){
      round = 1;
      startGame();
    }

    /* Retained for compatibility; not used for primary navigation anymore */
    function goHome(){
      try { bgm.pause(); bgm.currentTime = 0; } catch(e){}
      window.location.href = 'lesson-screen-htmls/lesson-03.01.html';
    }
  </script>
</body>
</html>
